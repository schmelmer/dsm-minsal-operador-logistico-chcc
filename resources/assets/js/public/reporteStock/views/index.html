<ui-view>
    <div class='row'>
        <article class="col-sm-12 col-md-12 col-lg-12">

            <!-- puntos entrega -->
            <div class="jarviswidget" id="stock-table">
                <header>
                    <span class="widget-icon"> <i class="fa fa-cubes"></i> </span>
                    <h2>Reporte de stock</h2>

                    <div class="widget-toolbar" role="menu">

                        <!-- territorio -->
                        <div class="btn-group">
                            <button class="btn dropdown-toggle btn-xs btn-success" data-toggle="dropdown" aria-expanded="false">
                                {{ vm.tipo}} <i class="fa fa-caret-down"></i>
                            </button>
                            <ul class="dropdown-menu pull-right js-status-update">
                                <li ng-repeat="territorio in ::vm.territorios" >
                                    <a ng-click="vm.filter(territorio)"><i class="fa"></i> {{ territorio.name }}</a>
                                </li>
                            </ul>
                        </div>

                        <!-- categoria -->
                        <div class="btn-group">
                            <button class="btn dropdown-toggle btn-xs btn-success" data-toggle="dropdown" aria-expanded="false">
                                Categoria: {{ vm.categoria}} <i class="fa fa-caret-down"></i>
                            </button>
                            <ul class="dropdown-menu pull-right js-status-update">
                                <li ng-repeat="categoria in ::vm.categorias" >
                                    <a ng-click="vm.changeCategoria(categoria)"><i class="fa"></i> {{ categoria.name }}</a>
                                </li>
                            </ul>
                        </div>

                        <!-- producto -->
                        <div class="btn-group">
                            <button class="btn dropdown-toggle btn-xs btn-success" data-toggle="dropdown" aria-expanded="false">
                                Producto: {{ vm.producto}} <i class="fa fa-caret-down"></i>
                            </button>

                            <ul class="dropdown-menu pull-right js-status-update">
                                <li ng-repeat="producto in ::vm.productos" >
                                    <a ng-click="vm.changeProducto(producto)"><i class="fa"></i> {{ producto.name }}</a>
                                </li>
                            </ul>
                        </div>

                        <!-- estado -->
                        <div class="btn-group">
                            <button class="btn dropdown-toggle btn-xs btn-success" data-toggle="dropdown" aria-expanded="false">
                                Estado: {{ vm.estado}} <i class="fa fa-caret-down"></i>
                            </button>

                            <ul class="dropdown-menu pull-right js-status-update">
                                <li ng-repeat="estado in ::vm.estados" >
                                    <a ng-click="vm.changeEstado(estado)"><i class="fa"></i> {{ estado.name }}</a>
                                </li>
                            </ul>
                        </div>

                        <!-- años -->
                        <div class="btn-group">
                            <button class="btn dropdown-toggle btn-xs btn-success" data-toggle="dropdown" aria-expanded="false">
                                Año: {{ vm.agno}} <i class="fa fa-caret-down"></i>
                            </button>

                            <ul class="dropdown-menu pull-right js-status-update">
                                <li ng-repeat="agno in vm.agnos" >
                                    <a ng-click="vm.changeAgno(agno)"><i class="fa"></i> {{ agno }}</a>
                                </li>
                            </ul>
                        </div>

                    </div>
                </header>

                <div class="widget-body">

                    <!-- sin pedidos -->
                    <div ng-if="vm.productosFilter.length == 0" class="alert alert-warning">
                        <i class="fa-fw fa fa-warning"></i>
                        <strong>Alerta:</strong> Actualmente no existen registros de pedidos. Seleccione algun tipo de territorio, categoria o producto.
                    </div>

                    <!-- resultados -->
                    <div ng-if="vm.productosFilter.length > 0"  class="" width="100%">
                        <!-- <table datatable="" dt&#45;options="vm.dtOptions"  dt&#45;columns="vm.dtColumns" dt&#45;instance="vm.dtInstance" class="table table&#45;striped table&#45;bordered table&#45;hover" width="100%"  style="display: block; overflow&#45;x: auto; white&#45;space: nowrap;"> -->
                        <table datatable="ng" dt-options="vm.dtOptions" class="table table-striped table-bordered table-hover" width="100%"  style="display: block; overflow-x: auto; white-space: nowrap;">
                            <thead>
                                <tr>
                                    <th>Tipo </th>
                                    <th ng-repeat="p in vm.productosFilter" colspan="5">{{ p.name }} </th>
                                    <th>Nº de solicitudes</th>
                                    <th>En solicitud</th>
                                    <th>En transito</th>
                                    <th>En destino</th>
                                </tr>
                                <tr>
                                    <th></th>
                                    <!-- por cada producto -->
                                    <th ng-if="0" ng-repeat-start="p in vm.productosFilter">
                                        <th ng-repeat="p in ['Asignados', 'Solicitados', 'Disponible', 'Disponible (unidades)', 'Poblacion']">
                                            {{ p }}
                                        </th>
                                        <th ng-if="0" ng-repeat-end></th>
                                    </th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="solicitud in vm.stock">
                                    <td>{{solicitud.nombre }}</td>
                                    <td ng-if="0" ng-repeat-start="producto in solicitud.productos">
                                        <td>{{ producto.asignados }}</td>
                                        <td>{{ producto.solicitados }}</td>
                                        <td>{{ producto.asignados - producto.solicitados }}</td>
                                        <td>{{ (producto.asignados - producto.solicitados) * producto.cajas }}</td>
                                        <td>{{ vm.productosKeys[producto.id][0].poblacion_id ? producto.poblacion : '-' }}</td>
                                        <td ng-if="0" ng-repeat-end></td>
                                    </td>
                                    <td>{{ solicitud.cantidadSolicitudes }}</td>
                                    <td>{{ solicitud.enSolicitud }}</td>
                                    <td>{{ solicitud.enTransito }}</td>
                                    <td>{{ solicitud.enDestino }}</td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th>Totales</th>
                                    <th ng-if="0" ng-repeat-start="p in vm.productosFilter">
                                        <th>{{ p.totalAsignados }} </th>
                                        <th>{{ p.totalSolicitados }} </th>
                                        <th>{{ p.totalDisponible }} </th>
                                        <th>{{ p.totalDisponibleStock }} </th>
                                        <th> - </th>
                                        <!-- <th>{{ p.totalPoblacion }} </th> -->
                                        <th ng-if="0" ng-repeat-end></th>
                                    </th>
                                    <th colspan="4"></th>
                                </tr>
                                <tr>
                                    <th>Stock Total</th>
                                    <!-- <th ng-repeat="p in vm.productosFilter" class="text-center"> -->
                                    <!--     {{ p.stock_cajas }}                                      -->
                                    <!-- </th>                                                        -->
                                    <th ng-if="0" ng-repeat-start="p in vm.productosFilter">
                                        <th>{{ p.stock_cajas }}</th> <!-- asignados -->
                                        <th>{{ p.stock_cajas }}</th> <!-- solicittados -->
                                        <th>{{ p.stock_cajas }}</th> <!-- disponible -->
                                        <th>{{ p.stock }}</th>       <!-- disponible unidades -->
                                        <th>{{ p.stock_cajas }}</th> <!-- poblacion -->
                                        <th ng-if="0" ng-repeat-end></th>
                                    </th>
                                    <th colspan="4"></th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
            </div>
        </article>
    </div>
</ui-view>

